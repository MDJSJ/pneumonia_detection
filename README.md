# åŸºäºæ·±åº¦å­¦ä¹ çš„è‚ºç‚å›¾åƒè¯†åˆ«å¤šæ–¹æ¡ˆå®ç°é¡¹ç›®

## ğŸ”¬ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„è‚ºç‚å›¾åƒè¯†åˆ«ç³»ç»Ÿï¼Œé›†æˆäº†å¤šç§æ·±åº¦å­¦ä¹ æŠ€æœ¯æ–¹æ¡ˆï¼Œæ—¨åœ¨é€šè¿‡èƒ¸éƒ¨ X å…‰å›¾åƒè‡ªåŠ¨è¯†åˆ«å’Œåˆ†ç±»è‚ºç‚ã€‚é¡¹ç›®åŒ…å«äº†ä»ç®€å•çš„è‡ªå®šä¹‰ CNN åˆ°å…ˆè¿›çš„è¿ç§»å­¦ä¹ ï¼Œå†åˆ°åŸºäºè®ºæ–‡çš„åˆ›æ–°æ¶æ„ç­‰å¤šç§å®ç°æ–¹æ³•ï¼Œä¸ºç ”ç©¶è€…å’Œå¼€å‘è€…æä¾›äº†å…¨é¢çš„æŠ€æœ¯å¯¹æ¯”å’Œé€‰æ‹©ã€‚

### ğŸ¯ ä¸»è¦ç‰¹æ€§

- **å¤šæŠ€æœ¯è·¯çº¿**ï¼š4 ç§ä¸åŒçš„æ·±åº¦å­¦ä¹ å®ç°æ–¹æ¡ˆ
- **çµæ´»åˆ†ç±»**ï¼šæ”¯æŒäºŒåˆ†ç±»ï¼ˆæ­£å¸¸/è‚ºç‚ï¼‰å’Œä¸‰åˆ†ç±»ï¼ˆæ­£å¸¸/ç»†èŒæ€§è‚ºç‚/ç—…æ¯’æ€§è‚ºç‚ï¼‰
- **å®Œæ•´å·¥å…·é“¾**ï¼šåŒ…å«è®­ç»ƒã€è¯„ä¼°ã€å¯è§†åŒ–å’Œé‡è®­ç»ƒç­‰å®Œæ•´åŠŸèƒ½
- **é«˜æ€§èƒ½**ï¼šæœ€ä½³æ–¹æ¡ˆè¾¾åˆ° 99.72%çš„è¯†åˆ«å‡†ç¡®ç‡
- **å¯è§£é‡Šæ€§**ï¼šé›†æˆé®æŒ¡å®éªŒå’Œç±»æ¿€æ´»å›¾å¯è§†åŒ–

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
pneumonia_detection/
â”œâ”€â”€ ğŸ”§ æ ¸å¿ƒå®ç°æ–¹æ¡ˆ
â”‚   â”œâ”€â”€ pneumonia_detection_pytorch.py    # æ–¹æ¡ˆ1ï¼šåŸºç¡€PyTorch CNNå®ç°
â”‚   â”œâ”€â”€ net/                               # æ–¹æ¡ˆ2ï¼šTensorFlow + Inceptionè¿ç§»å­¦ä¹ 
â”‚   â”‚   â”œâ”€â”€ train.py                       # - æ ¸å¿ƒè®­ç»ƒè„šæœ¬
â”‚   â”‚   â””â”€â”€ utils.py                       # - å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ pneumonia_net_implementation/      # æ–¹æ¡ˆ3ï¼šPneumoniaNetè®ºæ–‡å®ç°
â”‚   â”‚   â”œâ”€â”€ main.py                        # - 50å±‚X-blockæ¶æ„
â”‚   â”‚   â”œâ”€â”€ README.md                      # - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
â”‚   â”‚   â””â”€â”€ requirements.txt               # - ä¸“ç”¨ä¾èµ–
â”‚   â””â”€â”€ retrain.py                         # æ–¹æ¡ˆ4ï¼šInceptionæ¨¡å‹é‡è®­ç»ƒ
â”‚
â”œâ”€â”€ ğŸ” åˆ†æè¯„ä¼°å·¥å…·
â”‚   â”œâ”€â”€ evaluate_model.py                 # æ¨¡å‹æ€§èƒ½è¯„ä¼°
â”‚   â””â”€â”€ occlusion.py                       # é®æŒ¡æ•æ„Ÿåº¦åˆ†æ
â”‚
â”œâ”€â”€ ğŸ“Š æ•°æ®ä¸ç»“æœ
â”‚   â”œâ”€â”€ chest_xray_img/                   # æ ‡å‡†åŒ–æ•°æ®é›†
â”‚   â”‚   â”œâ”€â”€ train/ (NORMAL + PNEUMONIA)
â”‚   â”‚   â”œâ”€â”€ val/   (NORMAL + PNEUMONIA)
â”‚   â”‚   â””â”€â”€ test/  (NORMAL + PNEUMONIA)
â”‚   â””â”€â”€ runs/                              # è®­ç»ƒæ—¥å¿—å’Œå¯è§†åŒ–
â”‚
â””â”€â”€ ğŸ“‹ é¡¹ç›®æ–‡æ¡£
    â”œâ”€â”€ README.md                          # æœ¬æ–‡æ¡£
    â””â”€â”€ .gitignore                         # Gité…ç½®
```

## ğŸš€ æŠ€æœ¯æ–¹æ¡ˆè¯¦è§£

### æ–¹æ¡ˆ 1ï¼šåŸºç¡€ PyTorch CNN (`pneumonia_detection_pytorch.py`)

**é€‚ç”¨åœºæ™¯**ï¼šå¿«é€ŸåŸå‹å¼€å‘ã€æ•™å­¦æ¼”ç¤º

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- è½»é‡çº§ 3 å±‚ CNN æ¶æ„
- è¾“å…¥å°ºå¯¸ï¼š224Ã—224Ã—3
- äºŒåˆ†ç±»ï¼šæ­£å¸¸ vs è‚ºç‚
- è®­ç»ƒå‘¨æœŸï¼š30 epochs
- ä¼˜åŒ–å™¨ï¼šAdam (lr=0.0001)

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
python pneumonia_detection_pytorch.py
```

### æ–¹æ¡ˆ 2ï¼šTensorFlow Inception è¿ç§»å­¦ä¹  (`net/train.py`)

**é€‚ç”¨åœºæ™¯**ï¼šå·¥ä¸šçº§éƒ¨ç½²ã€é«˜ç²¾åº¦è¦æ±‚

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- åŸºäº Inception v3 é¢„è®­ç»ƒæ¨¡å‹
- Bottleneck ç‰¹å¾æå– (2048 ç»´)
- è¾“å…¥å°ºå¯¸ï¼š299Ã—299Ã—3
- è¿ç§»å­¦ä¹  + å¾®è°ƒç­–ç•¥
- æ”¯æŒ TensorBoard å¯è§†åŒ–

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
# éœ€è¦é…åˆretrain.pyä½¿ç”¨
python retrain.py --images chest_xray_img/ --training_steps 4000
```

### æ–¹æ¡ˆ 3ï¼šPneumoniaNet è®ºæ–‡å®ç° (`pneumonia_net_implementation/`)

**é€‚ç”¨åœºæ™¯**ï¼šå­¦æœ¯ç ”ç©¶ã€æœ€é«˜ç²¾åº¦éœ€æ±‚

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- åˆ›æ–°çš„ X-block ç‰¹å¾èåˆæ¶æ„
- 50 å±‚æ·±åº¦ç½‘ç»œ
- ä¸‰åˆ†ç±»ï¼šæ­£å¸¸/ç»†èŒæ€§è‚ºç‚/ç—…æ¯’æ€§è‚ºç‚
- äº”æŠ˜äº¤å‰éªŒè¯
- 99.72%çš„é¡¶çº§å‡†ç¡®ç‡
- é›†æˆ CAM å¯è§†åŒ–

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
cd pneumonia_net_implementation
pip install -r requirements.txt
python main.py
```

### æ–¹æ¡ˆ 4ï¼šInception é‡è®­ç»ƒ (`retrain.py`)

**é€‚ç”¨åœºæ™¯**ï¼šå¿«é€Ÿè¿ç§»å­¦ä¹ ã€è‡ªå®šä¹‰æ•°æ®é›†

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- Google Inception æ¶æ„
- å…¨è‡ªåŠ¨åŒ–è®­ç»ƒæµç¨‹
- çµæ´»çš„å‚æ•°é…ç½®
- æ”¯æŒå¤šç±»åˆ«æ‰©å±•

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
python retrain.py \
    --images chest_xray_img/ \
    --training_steps 4000 \
    --learning_rate 0.001
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŠ€æœ¯æ–¹æ¡ˆ         | æ¶æ„ç±»å‹     | åˆ†ç±»ç±»å‹ | å‡†ç¡®ç‡ | è®­ç»ƒæ—¶é—´ | æ¨¡å‹å¤§å° | æ¨èåœºæ™¯ |
| ---------------- | ------------ | -------- | ------ | -------- | -------- | -------- |
| åŸºç¡€ CNN         | è‡ªå®šä¹‰ 3 å±‚  | äºŒåˆ†ç±»   | ~85%   | çŸ­       | å°       | å¿«é€ŸåŸå‹ |
| Inception è¿ç§»   | é¢„è®­ç»ƒ+å¾®è°ƒ  | äºŒåˆ†ç±»   | ~95%   | ä¸­       | ä¸­       | å·¥ä¸šéƒ¨ç½² |
| PneumoniaNet     | X-block æ¶æ„ | ä¸‰åˆ†ç±»   | 99.72% | é•¿       | ä¸­       | å­¦æœ¯ç ”ç©¶ |
| Inception é‡è®­ç»ƒ | é¢„è®­ç»ƒæ›¿æ¢   | å¯é…ç½®   | ~93%   | ä¸­       | å¤§       | å¿«é€Ÿé€‚é… |

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- Python 3.7+
- GPU æ¨èï¼š4GB+ æ˜¾å­˜
- å†…å­˜ï¼š8GB+ RAM
- å­˜å‚¨ï¼š5GB+ å¯ç”¨ç©ºé—´

### å¿«é€Ÿå®‰è£…

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/pneumonia_detection.git
cd pneumonia_detection

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv pneumonia_env
source pneumonia_env/bin/activate  # Linux/macOS
# æˆ– pneumonia_env\Scripts\activate  # Windows

# 3. å®‰è£…æ ¸å¿ƒä¾èµ–
pip install torch torchvision tensorflow
pip install pillow numpy matplotlib scikit-learn seaborn
pip install opencv-python tensorboard pandas

# 4. éªŒè¯å®‰è£…
python -c "import torch, tensorflow as tf; print('âœ… ç¯å¢ƒé…ç½®æˆåŠŸ')"
```

### é’ˆå¯¹æ€§ä¾èµ–å®‰è£…

**ä»…ä½¿ç”¨ PyTorch æ–¹æ¡ˆ**ï¼š

```bash
pip install torch torchvision pillow numpy matplotlib
```

**ä»…ä½¿ç”¨ TensorFlow æ–¹æ¡ˆ**ï¼š

```bash
pip install tensorflow pillow numpy
```

**ä½¿ç”¨ PneumoniaNet æ–¹æ¡ˆ**ï¼š

```bash
cd pneumonia_net_implementation
pip install -r requirements.txt
```

## ğŸ“ æ•°æ®é›†å‡†å¤‡

### æ ‡å‡†æ•°æ®é›†ç»“æ„

```
chest_xray_img/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ NORMAL/              # æ­£å¸¸èƒ¸éƒ¨Xå…‰å›¾åƒ
â”‚   â”‚   â”œâ”€â”€ IM-0001-0001.jpeg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ PNEUMONIA/           # è‚ºç‚å›¾åƒ
â”‚       â”œâ”€â”€ person1_bacteria_1.jpeg    # ç»†èŒæ€§è‚ºç‚
â”‚       â”œâ”€â”€ person2_virus_1.jpeg       # ç—…æ¯’æ€§è‚ºç‚
â”‚       â””â”€â”€ ...
â”œâ”€â”€ val/                     # éªŒè¯é›†ï¼ˆç»“æ„åŒä¸Šï¼‰
â””â”€â”€ test/                    # æµ‹è¯•é›†ï¼ˆç»“æ„åŒä¸Šï¼‰
```

### æ•°æ®é›†æ¥æº

æ¨èä½¿ç”¨ä»¥ä¸‹å…¬å¼€æ•°æ®é›†ï¼š

1. **Kaggle è‚ºç‚æ•°æ®é›†**

   ```bash
   # ä¸‹è½½åœ°å€ï¼šhttps://www.kaggle.com/datasets/paultimothymooney/chest-xray-pneumonia
   ```

2. **Mendeley åŒ»å­¦å½±åƒæ•°æ®**
   ```bash
   # ä¸‹è½½åœ°å€ï¼šhttps://data.mendeley.com/datasets/rscbjbr9sj/2
   ```

### æ•°æ®é¢„å¤„ç†

æ‰€æœ‰æ–¹æ¡ˆéƒ½æ”¯æŒæ ‡å‡†çš„æ•°æ®é¢„å¤„ç†ï¼š

- å›¾åƒå°ºå¯¸è°ƒæ•´
- åƒç´ å€¼å½’ä¸€åŒ–
- RGB é€šé“è½¬æ¢
- æ•°æ®å¢å¼ºï¼ˆå¯é€‰ï¼‰

## ğŸ” åˆ†æå·¥å…·ä½¿ç”¨

### æ¨¡å‹è¯„ä¼°

```bash
# è¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹
python evaluate_model.py
```

è¾“å‡ºæŒ‡æ ‡ï¼š

- å‡†ç¡®ç‡ (Accuracy)
- ç²¾ç¡®ç‡ (Precision)
- å¬å›ç‡ (Recall)
- F1 åˆ†æ•°
- æ··æ·†çŸ©é˜µ

### é®æŒ¡æ•æ„Ÿåº¦åˆ†æ

```bash
# åˆ†ææ¨¡å‹å…³æ³¨åŒºåŸŸ
python occlusion.py \
    --image_dir /path/to/test/image.jpg \
    --graph retrained_graph.pb \
    --labels retrained_labels.txt
```

åŠŸèƒ½ï¼š

- ç”Ÿæˆçƒ­åŠ›å›¾æ˜¾ç¤ºæ¨¡å‹å…³æ³¨åŒºåŸŸ
- éªŒè¯æ¨¡å‹æ˜¯å¦å…³æ³¨æ­£ç¡®çš„åŒ»å­¦ç‰¹å¾
- æä¾›è¯Šæ–­å¯è§£é‡Šæ€§

## ğŸ¨ å¯è§†åŒ–åŠŸèƒ½

### TensorBoard ç›‘æ§

```bash
# å¯åŠ¨TensorBoard
tensorboard --logdir=runs/pneumonia_detection_experiment
# åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:6006
```

### ç»“æœå¯è§†åŒ–

PneumoniaNet æ–¹æ¡ˆè‡ªåŠ¨ç”Ÿæˆï¼š

- è®­ç»ƒ/éªŒè¯æ›²çº¿
- æ··æ·†çŸ©é˜µ
- ROC æ›²çº¿
- ç²¾ç¡®ç‡-å¬å›ç‡æ›²çº¿
- CAM ç±»æ¿€æ´»å›¾

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è®­ç»ƒå‚æ•°

**åŸºç¡€ CNN æ–¹æ¡ˆ**ï¼š

```python
# åœ¨pneumonia_detection_pytorch.pyä¸­ä¿®æ”¹
num_epochs = 50        # è®­ç»ƒè½®æ•°
batch_size = 32        # æ‰¹æ¬¡å¤§å°
learning_rate = 0.001  # å­¦ä¹ ç‡
```

**Inception æ–¹æ¡ˆ**ï¼š

```bash
python retrain.py \
    --training_steps 8000 \
    --learning_rate 0.0001 \
    --train_batch_size 64
```

**PneumoniaNet æ–¹æ¡ˆ**ï¼š

```python
# åœ¨pneumonia_net_implementation/main.pyä¸­ä¿®æ”¹äº¤å‰éªŒè¯å‚æ•°
kfold = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)
```

### GPU ä¼˜åŒ–

```python
# æ£€æŸ¥GPUå¯ç”¨æ€§
import torch
print(f"CUDAå¯ç”¨: {torch.cuda.is_available()}")
print(f"GPUæ•°é‡: {torch.cuda.device_count()}")

# è®¾ç½®GPUè®¾å¤‡
device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
```

## ğŸ“ˆ ä½¿ç”¨å»ºè®®

### é€‰æ‹©æŒ‡å—

**å¿«é€ŸéªŒè¯æ¦‚å¿µ**ï¼š
â†’ ä½¿ç”¨æ–¹æ¡ˆ 1ï¼ˆåŸºç¡€ CNNï¼‰

**å·¥ä¸šçº§éƒ¨ç½²**ï¼š
â†’ ä½¿ç”¨æ–¹æ¡ˆ 2ï¼ˆInception è¿ç§»å­¦ä¹ ï¼‰

**å­¦æœ¯ç ”ç©¶/æœ€é«˜ç²¾åº¦**ï¼š
â†’ ä½¿ç”¨æ–¹æ¡ˆ 3ï¼ˆPneumoniaNetï¼‰

**å¿«é€Ÿé€‚é…æ–°æ•°æ®**ï¼š
â†’ ä½¿ç”¨æ–¹æ¡ˆ 4ï¼ˆInception é‡è®­ç»ƒï¼‰

### æœ€ä½³å®è·µ

1. **æ•°æ®é¢„å¤„ç†**ï¼šç¡®ä¿å›¾åƒè´¨é‡å’Œæ ‡æ³¨å‡†ç¡®æ€§
2. **äº¤å‰éªŒè¯**ï¼šä½¿ç”¨åˆ†å±‚æŠ½æ ·é¿å…æ•°æ®åå·®
3. **è¶…å‚æ•°è°ƒä¼˜**ï¼šæ ¹æ®æ•°æ®é›†ç‰¹ç‚¹è°ƒæ•´å­¦ä¹ ç‡å’Œæ‰¹æ¬¡å¤§å°
4. **æ­£åˆ™åŒ–**ï¼šé€‚å½“ä½¿ç”¨ Dropout å’Œæ•°æ®å¢å¼ºé˜²æ­¢è¿‡æ‹Ÿåˆ
5. **æ¨¡å‹é›†æˆ**ï¼šç»“åˆå¤šä¸ªæ–¹æ¡ˆçš„é¢„æµ‹ç»“æœæé«˜é²æ£’æ€§

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**é—®é¢˜ 1**ï¼šCUDA å†…å­˜ä¸è¶³

```bash
# è§£å†³æ–¹æ¡ˆï¼šå‡å°æ‰¹æ¬¡å¤§å°
batch_size = 16  # æˆ–æ›´å°
```

**é—®é¢˜ 2**ï¼šå›¾åƒåŠ è½½å¤±è´¥

```bash
# æ£€æŸ¥å›¾åƒæ ¼å¼å’Œè·¯å¾„
file chest_xray_img/train/NORMAL/*.jpeg | head -5
```

**é—®é¢˜ 3**ï¼šä¾èµ–å†²çª

```bash
# ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒéš”ç¦»ä¾èµ–
python -m venv fresh_env
source fresh_env/bin/activate
```

### æ€§èƒ½è°ƒä¼˜

**å†…å­˜ä¼˜åŒ–**ï¼š

```python
torch.cuda.empty_cache()  # æ¸…ç†GPUç¼“å­˜
```

**è®­ç»ƒåŠ é€Ÿ**ï¼š

```python
# ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
from torch.cuda.amp import autocast, GradScaler
```
